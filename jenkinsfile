pipeline{  
		agent any 
 tools{
        maven 'maven'
        nodejs 'node 21.5'
        }
 
 stages{
	
          
    stage('Build Backend'){
            steps{
                dir('java/jtqj'){
                sh 'mvn clean install -DskipTest'
                }
            }
    }
    stage('Test Backend'){
            steps{
                dir('java/jtqj'){
                sh 'mvn test -Dmaven.install.skip=true'
                }
            }
    }
    stage('Sonar Backend'){
            steps{
                dir('java/jtqj'){
                    withSonarQubeEnv('SonarQube_server') {
                    sh 'mvn verify sonar:sonar -Dskiptest -Dmaven.install.skip=true'
                }
                }
            }
    }
      
    
    stage('Build Front'){
        steps{
            dir('angular'){
                sh 'npm install --force'
                sh 'wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -'
                sh 'echo "deb http://dl.google.com/linux/chrome/deb/ stable main" > /etc/apt/sources.list.d/google.list'
                sh 'apt-get update'
                sh 'apt-get install -y google-chrome-stable xvfb'
                sh 'npm i -g @angular/cli'
            }
        }
    }
    stage('Test Front'){
        steps{
            dir('angular/src'){
                sh 'npm run test-headless'
            }
        }
    }
    stage('Sonar Front'){
        steps{
            dir('Sonar Front'){
               withSonarQubeEnv('SonarQube_server') {
                   sh 'npx sonar-scanner -Dsonar.sources="."'
                }
            }
        }
    }
  }
}
